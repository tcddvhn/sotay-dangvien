<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S·ªï tay Nghi·ªáp v·ª• C√¥ng t√°c T·ªï ch·ª©c ƒê·∫£ng</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#cc0000">
    <link rel="icon" type="image/png" href="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Flag_of_the_Communist_Party_of_Vietnam.svg/1200px-Flag_of_the_Communist_Party_of_Vietnam.svg.png">

    <style>
        /* ==================================================================
           1. CSS CHUNG & GIAO DI·ªÜN
           ================================================================== */
        :root {
            --primary: #cc0000;
            --primary-dark: #a30000;
            --text: #333;
            --sidebar-bg: #2c3e50;
            --header-h: 50px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: var(--text); margin: 0; background: #f4f4f4; }
        
        /* HEADER MOBILE */
        .mobile-header {
            display: none; position: fixed; top: 0; left: 0; right: 0; height: var(--header-h);
            background: var(--primary); color: white; align-items: center; padding: 0 15px; z-index: 2000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .menu-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; margin-right: 15px; }
        .app-title { font-weight: bold; text-transform: uppercase; font-size: 1rem; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        @media (max-width: 992px) { .mobile-header { display: flex; } }

        /* SIDEBAR */
        .sidebar { 
            width: 280px; background: var(--sidebar-bg); color: white; padding: 20px; 
            position: fixed; top: 0; bottom: 0; left: 0; overflow-y: auto; z-index: 3000; 
            transition: transform 0.3s ease; box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        @media (max-width: 992px) { 
            .sidebar { transform: translateX(-100%); width: 85%; max-width: 320px; } 
            .sidebar.active { transform: translateX(0); } 
        }
        .sidebar h3 { border-bottom: 1px solid #555; padding-bottom: 15px; margin-top: 0; color: #f1c40f; text-align: center; font-size: 1.1rem; }
        .nav-list { list-style: none; padding: 0; }
        .nav-link { display: block; padding: 12px 15px; color: #ecf0f1; text-decoration: none; border-bottom: 1px solid rgba(255,255,255,0.05); transition:0.2s; font-size: 0.95rem; }
        .nav-link:hover { background: var(--primary); padding-left: 20px; }

        /* OVERLAY */
        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2500; display: none; backdrop-filter: blur(2px); }
        .overlay.active { display: block; }

        /* MAIN CONTENT */
        .main { padding: 20px; background: white; min-height: 100vh; transition: margin-left 0.3s; }
        @media (min-width: 992px) { .main { margin-left: 280px; padding: 40px 60px; } }
        @media (max-width: 992px) { .main { padding-top: 70px; } }

        h1 { color: var(--primary); border-bottom: 3px solid var(--primary); padding-bottom: 15px; margin-top: 0; font-size: 1.6rem; text-transform: uppercase; }
        .phan-header { background: #fcebeb; padding: 15px; border-left: 6px solid var(--primary); margin-top: 40px; color: var(--primary-dark); font-size: 1.3em; font-weight: bold; }
        .muc-header { color: #b71c1c; margin-top: 30px; font-weight: 700; font-size: 1.1em; }

        /* BOXES & BUTTONS */
        .step-box { background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 3px 6px rgba(0,0,0,0.05); }
        .tag-label { font-size: 0.75rem; text-transform: uppercase; color: #666; font-weight: bold; display: block; margin-bottom: 5px; }
        .step-title { font-weight: bold; color: var(--primary); margin-bottom: 10px; display: block; font-size: 1.05rem; }
        
        .btn-detail { display: inline-flex; align-items: center; justify-content: center; margin-top: 15px; background: #e3f2fd; color: #0d47a1; padding: 10px 20px; border-radius: 6px; border: 1px solid #90caf9; font-weight: bold; cursor: pointer; width: 100%; text-decoration:none; transition: all 0.2s; }
        .btn-detail:hover { background: #2196f3; color: white; }
        @media (min-width: 768px) { .btn-detail { width: auto; } }

        /* --- CSS CHO B·∫¢NG BI·ªÇU (TABLE) --- */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9rem; border: 1px solid #ddd; }
        .data-table th, .data-table td { border: 1px solid #ddd; padding: 10px; text-align: left; vertical-align: top; }
        .data-table th { background-color: #f2f2f2; color: var(--primary-dark); font-weight: bold; text-align: center; }
        .data-table tr:nth-child(even) { background-color: #fafafa; }
        .data-table tr:hover { background-color: #f1f1f1; }

        /* MODAL POPUP */
        .modal { display: none; position: fixed; z-index: 4000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; padding: 10px; }
        .modal-box { background: white; width: 100%; max-width: 800px; border-radius: 10px; overflow: hidden; max-height: 90vh; display: flex; flex-direction: column; animation: slideUp 0.3s; }
        .modal-head { background: var(--primary); color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 20px; overflow-y: auto; line-height: 1.6; text-align: justify; }
        @keyframes slideUp { from {transform: translateY(20px); opacity:0} to {transform: translateY(0); opacity:1} }

        /* ADMIN & EXPORT */
        #adminPanel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 5000; flex-direction: column; }
        @media (min-width: 768px) { #adminPanel { flex-direction: row; } }
        
        .admin-sidebar { background: #f8f9fa; border-bottom: 1px solid #ddd; padding: 10px; display: flex; flex-direction: column; }
        @media (min-width: 768px) { .admin-sidebar { width: 300px; height: 100vh; border-right: 1px solid #ddd; border-bottom: none; } }
        
        .admin-main { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; }
        
        .form-control { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; font-family: inherit; }
        .btn { padding: 10px 15px; border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold; margin-bottom: 5px; }
        .btn-save { background: #28a745; } .btn-close { background: #6c757d; } .btn-del { background: #dc3545; } .btn-add { background: #007bff; }

        #backToTop { display: none; position: fixed; bottom: 20px; right: 20px; z-index: 90; border: none; background: var(--primary); color: white; padding: 12px; border-radius: 50%; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
    </style>
</head>
<body>

    <div class="mobile-header">
        <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
        <span class="app-title">S·ªî TAY NGHI·ªÜP V·ª§</span>
    </div>

    <div class="overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <div style="text-align:right">
            <span onclick="toggleMenu()" style="cursor:pointer; font-size:1.5rem; padding:5px;">‚úï</span>
        </div>
        <h3>M·ª§C L·ª§C</h3>
        <ul class="nav-list" id="menuList"></ul>
        <div style="margin-top:30px; text-align:center; font-size:0.8rem; color:#999; border-top:1px solid #444; padding-top:20px;">
            <p>&copy; 2025 Ban T·ªï ch·ª©c Th√†nh ·ªßy</p>
            <span onclick="checkAdmin()" style="cursor:pointer; opacity:0.5">üîí Qu·∫£n tr·ªã h·ªá th·ªëng</span>
        </div>
    </div>

    <div class="main">
        <h1>H∆Ø·ªöNG D·∫™N NGHI·ªÜP V·ª§ C√îNG T√ÅC T·ªî CH·ª®C ƒê·∫¢NG V√Ä ƒê·∫¢NG VI√äN (2025)</h1>
        <p><i>(CƒÉn c·ª© H∆∞·ªõng d·∫´n s·ªë 10-HD/BTCTU v√† c√°c quy ƒë·ªãnh hi·ªán h√†nh)</i></p>
        <div id="dynamicContent"></div>
        <br><br><br>
    </div>

    <div id="popup" class="modal" onclick="closePopup(event)">
        <div class="modal-box">
            <div class="modal-head">
                <span>N·ªôi dung chi ti·∫øt</span>
                <span onclick="document.getElementById('popup').style.display='none'" style="cursor:pointer; font-size:1.2rem">‚úï</span>
            </div>
            <div class="modal-body" id="popupContent"></div>
        </div>
    </div>

    <button id="backToTop" onclick="window.scrollTo({top:0, behavior:'smooth'})">‚¨Ü</button>

    <div id="adminPanel">
        <div class="admin-sidebar">
            <div style="font-weight:bold; margin-bottom:10px">C·∫§U TR√öC S·ªî TAY</div>
            <button class="btn btn-add" onclick="addNewRoot()">+ Th√™m Ph·∫ßn L·ªõn</button>
            <div id="adminTree" style="flex:1; overflow-y:auto; margin-top:10px; border:1px solid #eee; background:white;"></div>
        </div>
        <div class="admin-main">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:10px">
                <h2 style="margin:0">Bi√™n t·∫≠p n·ªôi dung</h2>
                <div>
                    <button class="btn btn-save" onclick="saveData()">üíæ L∆∞u & L·∫•y m√£</button>
                    <button class="btn btn-close" onclick="document.getElementById('adminPanel').style.display='none'">ƒê√≥ng</button>
                </div>
            </div>
            
            <div id="editorArea" style="display:none">
                <div style="text-align:right"><button class="btn btn-del" onclick="deleteItem()">X√≥a m·ª•c n√†y</button></div>
                
                <label>Lo·∫°i (Tag):</label>
                <input type="text" id="inpTag" class="form-control" placeholder="VD: Quy tr√¨nh, H∆∞·ªõng d·∫´n...">
                
                <label>Ti√™u ƒë·ªÅ:</label>
                <input type="text" id="inpTitle" class="form-control">
                
                <label>N·ªôi dung hi·ªÉn th·ªã (T√≥m t·∫Øt):</label>
                <textarea id="inpSummary" class="form-control" rows="5"></textarea>
                
                <label>N·ªôi dung chi ti·∫øt (Popup/B·∫£ng bi·ªÉu HTML):</label>
                <p style="font-size:0.8rem; color:#666; margin:0"><i>D√°n m√£ HTML b·∫£ng v√†o ƒë√¢y ƒë·ªÉ hi·ªÉn th·ªã trong Popup.</i></p>
                <textarea id="inpDetail" class="form-control" rows="8"></textarea>

                <div style="margin-top:15px; border-top:1px dashed #ccc; padding-top:15px">
                    <button class="btn btn-add" style="background:#17a2b8" onclick="addSubItem()">+ Th√™m m·ª•c con</button>
                </div>
            </div>
            <div id="editorPlaceholder" style="text-align:center; color:#999; margin-top:50px">Ch·ªçn m·ªôt m·ª•c b√™n tr√°i ƒë·ªÉ s·ª≠a</div>
        </div>
    </div>

    <script>
        // --- 1. D·ªÆ LI·ªÜU ƒê·∫¶Y ƒê·ª¶ T·ª™ C√ÅC FILE ƒê√É G·ª¨I (Bao g·ªìm B·∫£ng bi·ªÉu v√† C·∫•u tr√∫c chu·∫©n) ---
        const initialData = [
            {
                id: 'p1', title: 'PH·∫¶N TH·ª® NH·∫§T: NGHI·ªÜP V·ª§ C√îNG T√ÅC ƒê·∫¢NG VI√äN', tag: '', summary: '', detail: '', level: 0,
                children: [
                    {
                        id: 'p1_1', title: 'I. K·∫æT N·∫†P ƒê·∫¢NG VI√äN', tag: '', level: 1, summary: '', detail: '',
                        children: [
                            {
                                id: 'p1_1_1', title: '1. Ti√™u chu·∫©n, ƒëi·ªÅu ki·ªán', tag: 'Quy ƒë·ªãnh', level: 2,
                                summary: 'Quy ƒë·ªãnh v·ªÅ Tu·ªïi ƒë·ªùi (18-60), Tr√¨nh ƒë·ªô h·ªçc v·∫•n (THCS tr·ªü l√™n) v√† c√°c ƒëi·ªÅu ki·ªán kh√°c.',
                                detail: '<p><b>1.1. V·ªÅ tu·ªïi ƒë·ªùi:</b><br>- T·∫°i th·ªùi ƒëi·ªÉm chi b·ªô x√©t k·∫øt n·∫°p, ng∆∞·ªùi v√†o ƒê·∫£ng ph·∫£i ƒë·ªß 18 tu·ªïi ƒë·∫øn ƒë·ªß 60 tu·ªïi (t√≠nh theo th√°ng).<br>- Vi·ªác k·∫øt n·∫°p v√†o ƒê·∫£ng nh·ªØng ng∆∞·ªùi tr√™n 60 tu·ªïi do c·∫•p ·ªßy tr·ª±c thu·ªôc Th√†nh ·ªßy xem x√©t, quy·∫øt ƒë·ªãnh.<br><br><b>1.2. V·ªÅ tr√¨nh ƒë·ªô h·ªçc v·∫•n:</b><br>- Ng∆∞·ªùi v√†o ƒê·∫£ng ph·∫£i c√≥ b·∫±ng t·ªët nghi·ªáp trung h·ªçc c∆° s·ªü ho·∫∑c t∆∞∆°ng ƒë∆∞∆°ng tr·ªü l√™n.<br>- ƒê·ªëi v·ªõi ng∆∞·ªùi d√¢n t·ªôc thi·ªÉu s·ªë, v√πng s√¢u v√πng xa... t·ªëi thi·ªÉu ho√†n th√†nh ch∆∞∆°ng tr√¨nh ti·ªÉu h·ªçc.</p>'
                            },
                            {
                                id: 'p1_1_2', title: '2. Th·ªß t·ª•c xem x√©t k·∫øt n·∫°p', tag: 'Quy tr√¨nh', level: 2,
                                summary: 'G·ªìm: ƒê∆°n xin v√†o ƒê·∫£ng, L√Ω l·ªãch, Gi·∫•y gi·ªõi thi·ªáu, Ngh·ªã quy·∫øt chi b·ªô...',
                                detail: '<p><b>H·ªì s∆° bao g·ªìm:</b></p><ul><li>ƒê∆°n xin v√†o ƒê·∫£ng (M·∫´u 1-KNƒê).</li><li>L√Ω l·ªãch c·ªßa ng∆∞·ªùi xin v√†o ƒê·∫£ng (M·∫´u 2-KNƒê).</li><li>Gi·∫•y gi·ªõi thi·ªáu c·ªßa ƒë·∫£ng vi√™n ch√≠nh th·ª©c (M·∫´u 3-KNƒê).</li><li>Ngh·ªã quy·∫øt gi·ªõi thi·ªáu c·ªßa BCH ƒêo√†n TNCS ho·∫∑c C√¥ng ƒëo√†n (M·∫´u 4-KNƒê).</li><li>T·ªïng h·ª£p √Ω ki·∫øn nh·∫≠n x√©t c·ªßa t·ªï ch·ª©c ƒëo√†n th·ªÉ (M·∫´u 5-KNƒê).</li><li>Ngh·ªã quy·∫øt x√©t ƒë·ªÅ ngh·ªã k·∫øt n·∫°p c·ªßa Chi b·ªô (M·∫´u 6-KNƒê).</li></ul>'
                            }
                        ]
                    },
                    {
                        id: 'p1_2', title: 'II. C√îNG NH·∫¨N ƒê·∫¢NG VI√äN CH√çNH TH·ª®C', tag: '', level: 1, summary: '', detail: '',
                        children: [
                            {
                                id: 'p1_2_1', title: 'Th·ªùi h·∫°n v√† ƒêi·ªÅu ki·ªán', tag: 'Quy ƒë·ªãnh', level: 2,
                                summary: 'Sau 12 th√°ng d·ª± b·ªã. Trong v√≤ng 30 ng√†y l√†m vi·ªác ph·∫£i x√©t c√¥ng nh·∫≠n.',
                                detail: '<p>- Trong th·ªùi h·∫°n 30 ng√†y l√†m vi·ªác k·ªÉ t·ª´ ng√†y ƒë·∫£ng vi√™n h·∫øt 12 th√°ng d·ª± b·ªã, chi b·ªô ph·∫£i x√©t v√† ƒë·ªÅ ngh·ªã c√¥ng nh·∫≠n ch√≠nh th·ª©c.<br>- N·∫øu kh√¥ng ƒë·ªß ƒëi·ªÅu ki·ªán th√¨ l√†m th·ªß t·ª•c x√≥a t√™n.</p>'
                            }
                        ]
                    }
                ]
            },
            {
                id: 'p_phuluc', title: 'PH·∫¶N PH·ª§ L·ª§C: C√ÅC BI·ªÇU M·∫™U & KHUNG TI√äU CH√ç', tag: '', summary: 'T·ªïng h·ª£p c√°c m·∫´u vƒÉn b·∫£n v√† khung ti√™u ch√≠ ƒë√°nh gi√°.', detail: '', level: 0,
                children: [
                    {
                        id: 'pl_1', title: 'Danh m·ª•c M·∫´u t√†i li·ªáu (K·∫øt n·∫°p, C√¥ng nh·∫≠n...)', tag: 'Tra c·ª©u', level: 1,
                        summary: 'B·∫£ng t·ªïng h·ª£p k√Ω hi·ªáu c√°c bi·ªÉu m·∫´u nghi·ªáp v·ª•.',
                        detail: `
                        <h3 style="text-align:center; color:#b71c1c;">DANH M·ª§C C√ÅC M·∫™U T√ÄI LI·ªÜU<br>V·ªÄ C√îNG T√ÅC T·ªî CH·ª®C ƒê·∫¢NG V√Ä ƒê·∫¢NG VI√äN</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width:15%">K√Ω hi·ªáu</th>
                                    <th>T√™n m·∫´u t√†i li·ªáu</th>
                                    <th style="width:25%">Ghi ch√∫</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background-color:#ffebee"><td colspan="3"><b>A. K·∫æT N·∫†P ƒê·∫¢NG VI√äN</b></td></tr>
                                <tr><td>1-KNƒê</td><td>ƒê∆°n xin v√†o ƒê·∫£ng</td><td>Ng∆∞·ªùi xin v√†o ƒê·∫£ng vi·∫øt</td></tr>
                                <tr><td>2-KNƒê</td><td>L√Ω l·ªãch c·ªßa ng∆∞·ªùi xin v√†o ƒê·∫£ng</td><td>Khai chi ti·∫øt</td></tr>
                                <tr><td>3-KNƒê</td><td>Gi·∫•y gi·ªõi thi·ªáu ng∆∞·ªùi ∆∞u t√∫ v√†o ƒê·∫£ng</td><td>C·ªßa ƒë·∫£ng vi√™n ch√≠nh th·ª©c</td></tr>
                                <tr><td>6-KNƒê</td><td>Ngh·ªã quy·∫øt ƒë·ªÅ ngh·ªã k·∫øt n·∫°p ƒë·∫£ng vi√™n</td><td>C·ªßa Chi b·ªô</td></tr>
                                
                                <tr style="background-color:#ffebee"><td colspan="3"><b>B. C√îNG NH·∫¨N ƒê·∫¢NG VI√äN CH√çNH TH·ª®C</b></td></tr>
                                <tr><td>10-CN</td><td>B·∫£n ki·ªÉm ƒëi·ªÉm c·ªßa ƒë·∫£ng vi√™n d·ª± b·ªã</td><td></td></tr>
                                <tr><td>12-CN</td><td>Ngh·ªã quy·∫øt ƒë·ªÅ ngh·ªã c√¥ng nh·∫≠n ƒë·∫£ng vi√™n ch√≠nh th·ª©c</td><td>C·ªßa Chi b·ªô</td></tr>
                                
                                <tr style="background-color:#ffebee"><td colspan="3"><b>C. XO√Å T√äN, RA KH·ªéI ƒê·∫¢NG</b></td></tr>
                                <tr><td>16-XTD</td><td>Ngh·ªã quy·∫øt ƒë·ªÅ ngh·ªã x√≥a t√™n ƒë·∫£ng vi√™n</td><td>Chi b·ªô</td></tr>
                            </tbody>
                        </table>
                        <p style="font-style:italic; margin-top:10px; text-align:center">(Ngu·ªìn: Ph·ª• l·ª•c H∆∞·ªõng d·∫´n s·ªë 10-HD/BTCTU)</p>
                        `
                    },
                    {
                        id: 'pl_2', title: 'Khung ti√™u ch√≠ ƒë√°nh gi√° L√£nh ƒë·∫°o/Qu·∫£n l√Ω', tag: 'Ph·ª• l·ª•c 2', level: 1,
                        summary: 'Tr√≠ch Ph·ª• l·ª•c 2: Khung ti√™u ch√≠ ƒë√°nh gi√° c√° nh√¢n gi·ªØ ch·ª©c v·ª• l√£nh ƒë·∫°o, qu·∫£n l√Ω.',
                        detail: `
                        <h3 style="text-align:center; color:#b71c1c;">PH·ª§ L·ª§C 2<br>KHUNG TI√äU CH√ç ƒê√ÅNH GI√Å C√Å NH√ÇN GI·ªÆ CH·ª®C V·ª§ L√ÉNH ƒê·∫†O, QU·∫¢N L√ù</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width:10%">STT</th>
                                    <th>N·ªôi dung Ch·ª©c danh</th>
                                    <th style="width:30%">K√Ω hi·ªáu bi·ªÉu</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td style="text-align:center">1</td><td>Ch·ª©c danh Ph√≥ Ch·ªß t·ªãch HƒêND Th√†nh ph·ªë</td><td>Bi·ªÉu s·ªë 01-LƒêQL</td></tr>
                                <tr><td style="text-align:center">2</td><td>Ch·ª©c danh Ph√≥ Ch·ªß t·ªãch UBND Th√†nh ph·ªë</td><td>Bi·ªÉu s·ªë 02-LƒêQL</td></tr>
                                <tr><td style="text-align:center">3</td><td>Ch·ª©c danh Ph√≥ Tr∆∞·ªüng ƒêo√†n ƒêBQH Th√†nh ph·ªë</td><td>Bi·ªÉu s·ªë 03-LƒêQL</td></tr>
                                <tr><td style="text-align:center">4</td><td>Ch·ª©c danh ƒê·∫°i bi·ªÉu Qu·ªëc h·ªôi chuy√™n tr√°ch</td><td>Bi·ªÉu s·ªë 04-LƒêQL</td></tr>
                                <tr><td style="text-align:center">5</td><td>Ch·ª©c danh Tr∆∞·ªüng ban, c∆° quan tham m∆∞u gi√∫p vi·ªác TU</td><td>Bi·ªÉu s·ªë 05-LƒêQL</td></tr>
                                <tr><td style="text-align:center">6</td><td>Ch·ª©c danh Ph√≥ Tr∆∞·ªüng ban, c∆° quan tham m∆∞u gi√∫p vi·ªác TU</td><td>Bi·ªÉu s·ªë 06-LƒêQL</td></tr>
                                <tr><td style="text-align:center">7</td><td>Ch·ª©c danh ·ª¶y vi√™n ·ª¶y ban ki·ªÉm tra Th√†nh ·ªßy</td><td>Bi·ªÉu s·ªë 07-LƒêQL</td></tr>
                            </tbody>
                        </table>
                        `
                    }
                ]
            }
        ];

        // --- 2. X·ª¨ L√ù D·ªÆ LI·ªÜU (QUAN TR·ªåNG: ƒê·ªîI KEY ƒê·ªÇ RESET CACHE NG∆Ø·ªúI D√ôNG) ---
        let APP_DATA = initialData;
        try {
            // S·ª≠ d·ª•ng Key m·ªõi 'SOTAY_DATA_FINAL' ƒë·ªÉ ƒë·∫£m b·∫£o t·∫£i d·ªØ li·ªáu m·ªõi nh·∫•t
            const stored = localStorage.getItem('SOTAY_DATA_FINAL');
            if(stored) APP_DATA = JSON.parse(stored);
        } catch(e) { console.log("Offline mode"); }
        
        let currentEditNode = null;

        // --- 3. RENDER UI ---
        function renderUI() {
            const menu = document.getElementById('menuList');
            const content = document.getElementById('dynamicContent');
            menu.innerHTML = ''; content.innerHTML = '';

            function processNode(items) {
                items.forEach(item => {
                    // MENU SIDEBAR
                    if(item.level < 2) {
                        let li = document.createElement('li');
                        let indent = item.level === 1 ? '&nbsp;&nbsp;üìÇ ' : '';
                        li.innerHTML = `<a href="#${item.id}" onclick="toggleMenu(false)" class="nav-link">${indent}${item.title}</a>`;
                        menu.appendChild(li);
                    }

                    // CONTENT
                    let div = document.createElement('div');
                    div.id = item.id;
                    
                    if(item.level === 0) {
                        div.innerHTML = `<div class="phan-header">${item.title}</div>`;
                    } else if (item.level === 1) {
                        div.innerHTML = `<div class="muc-header">${item.title}</div>`;
                        if(item.summary) div.innerHTML += `<p>${item.summary.replace(/\n/g, '<br>')}</p>`;
                    } else {
                        // Level 2+ (H·ªôp quy tr√¨nh/Bi·ªÉu m·∫´u)
                        let tagHtml = item.tag ? `<span class="tag-label">${item.tag}</span>` : '';
                        let btnHtml = (item.detail && item.detail.trim() !== "") ? 
                            `<a class="btn-detail" onclick="openPopup('${item.id}')">üìñ Xem chi ti·∫øt / Bi·ªÉu m·∫´u</a>` : '';
                        
                        div.className = 'step-box';
                        div.innerHTML = `
                            ${tagHtml}
                            <span class="step-title">${item.title}</span>
                            <div style="font-size:0.95rem">${item.summary.replace(/\n/g, '<br>')}</div>
                            ${btnHtml}
                        `;
                    }
                    content.appendChild(div);
                    if(item.children) processNode(item.children);
                });
            }
            processNode(APP_DATA);
        }

        function toggleMenu(forceState) {
            const sb = document.getElementById('sidebar');
            const ov = document.querySelector('.overlay');
            if(typeof forceState !== 'undefined') {
                if(forceState) { sb.classList.add('active'); ov.classList.add('active'); }
                else { sb.classList.remove('active'); ov.classList.remove('active'); }
            } else { sb.classList.toggle('active'); ov.classList.toggle('active'); }
        }

        // T√¨m ki·∫øm node ƒë·ªá quy
        function findNodeRecursive(id, nodes) {
            for(let node of nodes) {
                if(node.id === id) return node;
                if(node.children) { let found = findNodeRecursive(id, node.children); if(found) return found; }
            }
            return null;
        }

        function openPopup(id) {
            const item = findNodeRecursive(id, APP_DATA);
            if(item) {
                document.getElementById('popupContent').innerHTML = item.detail;
                document.getElementById('popup').style.display = 'flex';
            }
        }
        function closePopup(e) { if(e.target.id === 'popup') document.getElementById('popup').style.display='none'; }

        window.onscroll = function() {
            document.getElementById("backToTop").style.display = (window.scrollY > 300) ? "block" : "none";
        };

        // --- 5. QU·∫¢N TR·ªä & XU·∫§T D·ªÆ LI·ªÜU ---
        function checkAdmin() {
            // M·∫¨T KH·∫®U QU·∫¢N TR·ªä: btctuhn@123
            let p = prompt("Nh·∫≠p m·∫≠t kh·∫©u qu·∫£n tr·ªã:");
            if(p === "btctuhn@123") {
                document.getElementById('adminPanel').style.display = 'flex';
                renderAdminTree();
            } else if (p !== null) { alert("Sai m·∫≠t kh·∫©u!"); }
        }

        function renderAdminTree() {
            const container = document.getElementById('adminTree');
            container.innerHTML = '';
            
            function buildHtml(nodes) {
                let html = '';
                nodes.forEach(node => {
                    let active = (currentEditNode && currentEditNode.id === node.id) ? 'background:#e3f2fd; color:#007bff; font-weight:bold;' : '';
                    let icon = node.level === 0 ? 'üìö' : (node.level === 1 ? 'üìÇ' : 'üìÑ');
                    let padding = node.level * 20 + 10;
                    
                    html += `<div style="padding:10px; padding-left:${padding}px; border-bottom:1px solid #eee; cursor:pointer; ${active}" onclick="selectItem('${node.id}')">
                                ${icon} ${node.title}
                             </div>`;
                    if(node.children) html += buildHtml(node.children);
                });
                return html;
            }
            container.innerHTML = buildHtml(APP_DATA);
        }

        function selectItem(id) {
            currentEditNode = findNodeRecursive(id, APP_DATA);
            renderAdminTree();
            document.getElementById('editorPlaceholder').style.display = 'none';
            document.getElementById('editorArea').style.display = 'block';
            
            document.getElementById('inpTag').value = currentEditNode.tag || '';
            document.getElementById('inpTitle').value = currentEditNode.title || '';
            document.getElementById('inpSummary').value = currentEditNode.summary || '';
            document.getElementById('inpDetail').value = currentEditNode.detail || '';
        }

        // Binding input events
        ['inpTag', 'inpTitle', 'inpSummary', 'inpDetail'].forEach(fid => {
            document.getElementById(fid).addEventListener('input', function() {
                if(!currentEditNode) return;
                let prop = fid.replace('inp','').toLowerCase();
                if(prop === 'tag') currentEditNode.tag = this.value;
                if(prop === 'title') currentEditNode.title = this.value;
                if(prop === 'summary') currentEditNode.summary = this.value;
                if(prop === 'detail') currentEditNode.detail = this.value;
                if(prop === 'title') renderAdminTree();
            });
        });

        function addNewRoot() {
            APP_DATA.push({id: 'r'+Date.now(), title:'PH·∫¶N M·ªöI', tag:'', summary:'', detail:'', level:0, children:[]});
            renderAdminTree();
        }
        function addSubItem() {
            if(!currentEditNode) return;
            if(!currentEditNode.children) currentEditNode.children = [];
            currentEditNode.children.push({id: 'n'+Date.now(), title:'M·ª•c m·ªõi', tag:'', summary:'', detail:'', level: currentEditNode.level+1, children:[]});
            renderAdminTree();
        }
        
        function findParent(id, nodes) {
            for(let node of nodes) {
                if(node.children && node.children.some(c => c.id === id)) return node;
                let f = findParent(id, node.children || []); if(f) return f;
            } return null;
        }

        function deleteItem() {
            if(!currentEditNode || !confirm('X√≥a m·ª•c n√†y?')) return;
            let p = findParent(currentEditNode.id, APP_DATA);
            if(p) { let idx = p.children.findIndex(c=>c.id === currentEditNode.id); p.children.splice(idx,1); }
            else { let idx = APP_DATA.findIndex(c=>c.id === currentEditNode.id); APP_DATA.splice(idx,1); }
            currentEditNode = null; document.getElementById('editorArea').style.display='none'; renderAdminTree();
        }

        // --- T√çNH NƒÇNG XU·∫§T D·ªÆ LI·ªÜU CHIA S·∫∫ (L∆∞u & Copy Code) ---
        function saveData() {
            // 1. L∆∞u LocalStorage
            try { localStorage.setItem('SOTAY_DATA_FINAL', JSON.stringify(APP_DATA)); } catch(e){}
            renderUI();

            // 2. Hi·ªán Popup l·∫•y m√£ code
            showExportPopup();
        }

        function showExportPopup() {
            const jsonContent = JSON.stringify(APP_DATA, null, 4);
            const html = `
                <div style="background:white; padding:20px; border-radius:8px; width:90%; max-width:600px; box-shadow:0 5px 20px rgba(0,0,0,0.3)">
                    <h3 style="margin-top:0; color:#cc0000">üì§ XU·∫§T D·ªÆ LI·ªÜU WEB</h3>
                    <p style="font-size:0.9rem">Copy to√†n b·ªô m√£ d∆∞·ªõi ƒë√¢y, d√°n v√†o d√≤ng <code>const initialData = ...</code> trong file index.html v√† √∫p l√™n GitHub.</p>
                    <textarea id="codeExport" style="width:100%; height:200px; font-family:monospace; font-size:0.8rem; border:1px solid #ccc">const initialData = ${jsonContent};</textarea>
                    <div style="text-align:right; margin-top:10px">
                        <button onclick="copyCode()" style="background:#28a745; color:white; border:none; padding:10px 20px; border-radius:4px; font-weight:bold; cursor:pointer; margin-right:10px;">üìã Copy Code</button>
                        <button onclick="document.getElementById('modalExport').remove()" style="background:#6c757d; color:white; border:none; padding:10px 20px; border-radius:4px; cursor:pointer">ƒê√≥ng</button>
                    </div>
                </div>
            `;
            let div = document.createElement('div');
            div.id = 'modalExport';
            div.style.cssText = "position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; display:flex; justify-content:center; align-items:center";
            div.innerHTML = html;
            document.body.appendChild(div);
        }

        function copyCode() {
            let t = document.getElementById('codeExport');
            t.select(); navigator.clipboard.writeText(t.value);
            alert("ƒê√£ Copy! H√£y d√°n ƒë√® v√†o d√≤ng 'const initialData = ...' trong file index.html");
        }

        // Start App
        renderUI();
    </script>
</body>
</html>